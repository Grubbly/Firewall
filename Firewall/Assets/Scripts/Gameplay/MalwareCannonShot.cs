using System.Collections;
using System.Collections.Generic;
using UnityEngine;

using Photon.Pun;
using System.IO;

public class MalwareCannonShot : MonoBehaviour
{
    [SerializeField]
    private GameObject cannonBallPrefab;
    [SerializeField]
    private PhotonView photonView;

    public float shotCost = 10f;

    public float thrust = 500f;

    private PointsManager manager;

    private void Start() {
        photonView = GetComponent<PhotonView>();
        manager = GameObject.Find("PointManager").GetComponent<PointsManager>();
    }

    private void OnTriggerStay(Collider other) {
        if(Input.GetKeyDown(KeyCode.E) && other.tag != "malware") {
            if(manager.getPoints() >= shotCost) {
                manager.spendPoints(shotCost);
                Debug.Log(other.gameObject + " spent " + shotCost.ToString("0.00") + " points to fire cannon");
                fire();
            } else {
                Debug.Log(other.gameObject + " attempted to shoot - NOT ENOUGH POINTS");
            }
        }
    }

    public void fire() {
        photonView.RPC("shoot", RpcTarget.All);
    }

    [PunRPC]
    public void shoot() {
        Debug.Log(gameObject + " firing cannon!");
        GameObject cannonBall = Instantiate(
            cannonBallPrefab, 
            transform.position, 
            transform.rotation
        );
    }
}
